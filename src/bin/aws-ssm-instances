#!/bin/bash

function main() {
  local awsprofile;

  if [[ -n "$1" ]]
  then
    awsprofile="$1"
  else
    echo "Missing AWS profile name: `basename $0` PROFILE_NAME"
    exit 1
  fi

  aws ssm describe-instance-information --profile $awsprofile --filters=Key=AssociationStatus,Values=Success |
    jq --raw-output '.InstanceInformationList[] | "\(.ComputerName)|\(.InstanceId)"' |
    sort |
    column -t -s'|'
}

main $*

# Keep this for extracting instance IDs for scripting
# fzf --select-1 --exit-0 | awk -F' ' '{print $NF}'
